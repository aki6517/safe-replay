# AutoTracker 要件定義書（補足版）

**バージョン:** 1.1  
**作成日:** 2025年12月10日  
**最終更新:** 2025年12月10日  
**ステータス:** Approved

---

## 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [背景と課題](#2-背景と課題)
3. [目的とゴール](#3-目的とゴール)
4. [ターゲットユーザー](#4-ターゲットユーザー)
5. [機能要件](#5-機能要件)
6. [非機能要件](#6-非機能要件)
7. [システム構成](#7-システム構成)
8. [データモデル](#8-データモデル)
9. [UI/UX要件](#9-uiux要件)
10. [セキュリティ要件](#10-セキュリティ要件)
11. [パフォーマンス要件](#11-パフォーマンス要件)
12. [AI判定要件](#12-ai判定要件)
13. [コスト管理](#13-コスト管理)
14. [制約事項](#14-制約事項)
15. [開発スコープ](#15-開発スコープ)
16. [成功指標](#16-成功指標)
17. [【補足】エラーハンドリング要件](#17-補足エラーハンドリング要件)
18. [【補足】バックアップ・リカバリ要件](#18-補足バックアップリカバリ要件)
19. [【補足】テスト要件](#19-補足テスト要件)
20. [【補足】運用・監視要件](#20-補足運用監視要件)

---

## 1. プロジェクト概要

### 1.1 プロジェクト名
**AutoTracker** - AI-Powered Automatic Time Tracking for Freelancers

### 1.2 プロダクト概要
ADHDなどの注意欠陥を持つフリーランス向けの、完全自動時間管理ツール。ユーザーの操作なしに画面を監視し、AIが作業内容を判定して自動的に時間を記録する。

### 1.3 プロダクトの価値提案
- **完全自動**: ボタン押下や手動入力が不要
- **高精度**: AI画面解析による92-99%の判定精度
- **ADHD特化**: 認知負荷を最小化した設計
- **複数案件対応**: フリーランスの複雑な業務フローに対応
- **透明性**: 全ての判定根拠を可視化

### 1.4 競合との差別化

| 項目 | AutoTracker | Tyme | Toggl | Timely |
|------|-------------|------|-------|--------|
| 自動トラッキング | ◎ 完全自動 | △ 手動ボタン | △ 手動ボタン | ○ 半自動 |
| AI判定 | ◎ 画面解析 | × なし | × なし | △ 簡易 |
| ADHD対応 | ◎ 特化 | × 未対応 | × 未対応 | △ 部分対応 |
| 対応OS | ◎ Win/Mac | △ Apple のみ | ○ 全OS | ○ 全OS |
| 価格 | $14.99/月 | $13/月 | $10/月 | $18/月 |

---

## 2. 背景と課題

### 2.1 ユーザーが抱える課題

#### 2.1.1 ADHD特有の課題
- **記憶の困難**: タイマー起動を忘れる
- **タスク切り替えの頻発**: 5分ごとに別の作業に移る
- **時間感覚の欠如**: 何時間働いたか分からない
- **ルーチン維持の困難**: 毎回ボタンを押す習慣が続かない

#### 2.1.2 フリーランス特有の課題
- **複数案件の並行**: 1日に3-5案件を切り替える
- **時給換算の困難**: 正確な稼働時間が不明
- **請求書作成の負担**: 手動集計に時間がかかる
- **証跡の必要性**: クライアントへの報告義務

#### 2.1.3 既存ツールの限界
- **手動操作が前提**: ADHDには継続困難
- **判定精度が低い**: アプリ名だけでは不十分
- **設定が複雑**: 初期設定で挫折
- **高額**: 月額$20以上が多い

---

## 3. 目的とゴール

### 3.1 プロダクトの目的
1. **ADHD当事者の時間管理を完全自動化**
2. **フリーランスの収入安定化に貢献**
3. **時間管理の不安とストレスを解消**

### 3.2 ビジネスゴール
- **1年目**: 500ユーザー獲得、MRR $9,995
- **3年目**: 2,550ユーザー獲得、MRR $48,974
- **利益率**: 82-83%を維持

### 3.3 ユーザーゴール
- **精度**: 作業時間記録の正確性 95%以上
- **効率**: 時間管理にかける時間を90%削減
- **収入**: 請求漏れによる収入損失を100%防止
- **安心**: 時間管理の不安を解消

---

## 4. ターゲットユーザー

### 4.1 プライマリーペルソナ

**名前:** 田中健一（35歳）  
**職業:** フリーランスマーケター  
**診断:** ADHD（注意欠陥多動性障害）

**プロフィール:**
- 複数のクライアント案件を並行（3-5案件）
- 時給制の業務委託契約が中心
- 過去に請求漏れで収入減少の経験
- デジタルツールに慣れているが、習慣化が苦手

**ペインポイント:**
- タイマー起動を忘れる（週3-4回）
- 何の作業を何時間したか分からない
- 請求書作成に毎月5-8時間かかる
- クライアントへの報告が曖昧で不安

### 4.2 セカンダリーペルソナ

**名前:** 佐藤美咲（28歳）  
**職業:** フリーランスデザイナー  
**特徴:** ADHDではないが、マルチタスクが多い

### 4.3 ユーザーセグメント

| セグメント | 割合 | 特徴 | 価格感度 |
|-----------|------|------|---------|
| ADHD個人 | 60% | 自動化必須、精度重視 | 低（必需品） |
| 複数案件持ち | 30% | 効率重視、機能豊富 | 中 |
| 小規模チーム | 10% | 管理機能必要 | 低 |

---

## 5. 機能要件

### 5.1 コア機能

#### 5.1.1 自動トラッキング機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| FR-001 | スクリーンショット取得 | 30秒〜2分間隔で画面キャプチャ | P1 |
| FR-002 | メタデータ収集 | ウィンドウタイトル/URL/アプリ名を5秒ごと取得 | P1 |
| FR-003 | 変化検知 | 5層の変化検知（タイトル/OCR/画像/ルール/AI） | P1 |
| FR-004 | AI画面解析 | gpt-5-nano(1次) + gpt-5-mini(2次)で判定 | P1 |

#### 5.1.2 プロジェクト管理機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| FR-005 | プロジェクト登録 | 名前/クライアント/カラー/時給/予算時間 | P1 |
| FR-006 | 自動検出ルール設定 | 正規表現/キーワード/アプリ名でマッチング | P1 |
| FR-007 | プロジェクトアーカイブ | 完了プロジェクトの保管と復元 | P2 |

#### 5.1.3 タイムライン機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| FR-008 | リアルタイム表示 | 現在の作業/経過時間/信頼度を表示 | P1 |
| FR-009 | タイムライン表示 | 時系列作業記録の可視化 | P1 |
| FR-010 | 手動編集機能 | 分割/結合/変更/削除/追加 | P1 |
| FR-011 | 異常検知 | 短時間エントリー/重複/未分類を検知 | P2 |

#### 5.1.4 レポート機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| FR-012 | レポート生成 | 日次/週次/月次/カスタム期間 | P1 |
| FR-013 | レポート内容 | 総時間/内訳/グラフ/売上計算 | P1 |
| FR-014 | エクスポート | PDF/CSV/JSON | P2 |
| FR-015 | レポート自動送信 | メール自動送信（設定可能） | P3 |

#### 5.1.5 確認・通知機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| FR-016 | 案件切り替え確認 | 信頼度<85%で通知（1時間に最大3回） | P1 |
| FR-017 | 異常アラート | 頻繁切替/長時間固定/休憩未取得 | P2 |
| FR-018 | リマインダー | 起動忘れ/日次確認/週次確認 | P2 |

#### 5.1.6 設定機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| FR-019 | トラッキング設定 | 間隔/頻度/自動起動/休憩検出 | P1 |
| FR-020 | 通知設定 | 切替確認/アラート/レポート通知 | P1 |
| FR-021 | プライバシー設定 | 保存場所/期間/パスワード検出/除外キーワード | P1 |
| FR-022 | 外観設定 | テーマ/カラー/フォントサイズ | P2 |

### 5.2 Phase 1（MVP）対象機能

Phase 1では以下の機能に絞る：

- ✅ FR-001〜FR-004: 自動トラッキング基本機能
- ✅ FR-005〜FR-006: プロジェクト管理基本
- ✅ FR-008〜FR-010: タイムライン基本
- ✅ FR-012〜FR-013: 日次レポート
- ✅ FR-016: 案件切り替え確認
- ✅ FR-019〜FR-021: 基本設定

---

## 6. 非機能要件

### 6.1 可用性（Availability）

| ID | 要件 | 目標値 |
|----|------|--------|
| NFR-001 | 稼働率 | 99.5%（月間ダウンタイム3.6時間以内） |
| NFR-002 | オフライン動作 | ローカル完全動作、ネット復旧時自動同期 |
| NFR-003 | 障害復旧 | 最大5分前のデータまで復元 |

### 6.2 パフォーマンス（Performance）

| ID | 要件 | 目標値 |
|----|------|--------|
| NFR-004 | UI応答時間 | 100ms以内 |
| NFR-005 | AI判定時間 | 5秒以内 |
| NFR-006 | レポート生成 | 30秒以内（月間データ） |
| NFR-007 | CPU使用率（アイドル） | 1%以下 |
| NFR-008 | メモリ使用 | 300MB以下 |
| NFR-009 | ディスク使用（7日間） | 1GB以下 |
| NFR-010 | アプリ起動（Cold） | 3秒以内 |

### 6.3 互換性（Compatibility）

| ID | 要件 | 対応範囲 |
|----|------|----------|
| NFR-011 | Windows | 10, 11（64bit） |
| NFR-012 | macOS | 12 Monterey以降 |
| NFR-013 | ブラウザ | Chrome/Edge/Safari/Firefox最新版 |

### 6.4 保守性（Maintainability）

| ID | 要件 | 目標値 |
|----|------|--------|
| NFR-014 | TypeScript使用率 | 100% |
| NFR-015 | テストカバレッジ | 80%以上 |
| NFR-016 | ESLint/Prettier | 強制適用 |

---

## 7. システム構成

### 7.1 アーキテクチャ概要

```
┌─────────────────────────────────────────┐
│         Electron Desktop App            │
│  ┌───────────────────────────────────┐  │
│  │     React Frontend (UI)           │  │
│  │  - TypeScript + Tailwind CSS      │  │
│  │  - shadcn/ui + Recharts           │  │
│  │  - Zustand (状態管理)              │  │
│  └───────────────────────────────────┘  │
│                  ↓ IPC                  │
│  ┌───────────────────────────────────┐  │
│  │     Main Process (Node.js)        │  │
│  │  - Screen Capture                 │  │
│  │  - Window Monitor                 │  │
│  │  - File System Access             │  │
│  └───────────────────────────────────┘  │
│                  ↓                      │
│  ┌───────────────────────────────────┐  │
│  │     Core Logic (TypeScript)       │  │
│  │  - Change Detection Engine        │  │
│  │  - OCR Processing (Tesseract.js)  │  │
│  │  - Rule Matching Engine           │  │
│  │  - Time Calculation Service       │  │
│  └───────────────────────────────────┘  │
│                  ↓                      │
│  ┌───────────────────────────────────┐  │
│  │     Local Storage                 │  │
│  │  - SQLite + better-sqlite3        │  │
│  │  - Encrypted Screenshots (AES-256)│  │
│  │  - electron-store (設定)           │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
                  ↓
         (必要時のみ外部通信)
                  ↓
┌─────────────────────────────────────────┐
│         External Services               │
│  ┌───────────────────────────────────┐  │
│  │     OpenAI API                    │  │
│  │  - gpt-5-nano (1次判定)            │  │
│  │  - gpt-5-mini (2次判定)            │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

### 7.2 技術スタック

| レイヤー | 技術 | バージョン |
|---------|------|-----------|
| フレームワーク | Electron | 28+ |
| フロントエンド | React + TypeScript | 18+ / 5+ |
| スタイリング | Tailwind CSS | 3+ |
| UIコンポーネント | shadcn/ui | 最新 |
| グラフ | Recharts | 最新 |
| 状態管理 | Zustand | 最新 |
| データベース | SQLite (better-sqlite3) | 最新 |
| OCR | Tesseract.js | 5+ |
| AI | OpenAI API (gpt-5-nano/mini) | 最新 |

---

## 8. データモデル

### 8.1 主要エンティティ

```
┌──────────────┐     ┌──────────────┐
│   Project    │     │    Entry     │
├──────────────┤     ├──────────────┤
│ id           │◄────│ project_id   │
│ name         │     │ id           │
│ client_name  │     │ start_time   │
│ color        │     │ end_time     │
│ hourly_rate  │     │ confidence   │
│ budget_hours │     │ ai_reasoning │
│ is_archived  │     │ is_manual    │
│ created_at   │     │ created_at   │
└──────────────┘     └──────────────┘
                            │
                            ▼
┌──────────────┐     ┌──────────────┐
│     Rule     │     │  Screenshot  │
├──────────────┤     ├──────────────┤
│ id           │     │ id           │
│ project_id   │     │ entry_id     │
│ type         │     │ file_path    │
│ pattern      │     │ timestamp    │
│ priority     │     │ metadata     │
│ is_enabled   │     │ ocr_text     │
└──────────────┘     └──────────────┘

┌──────────────┐     ┌──────────────┐
│   Setting    │     │  AIUsageLog  │
├──────────────┤     ├──────────────┤
│ key          │     │ id           │
│ value        │     │ model        │
│ updated_at   │     │ tokens_in    │
└──────────────┘     │ tokens_out   │
                     │ cost         │
                     │ created_at   │
                     └──────────────┘
```

---

## 9. UI/UX要件

### 9.1 デザインシステム

#### カラーパレット（ダークモード基準）
- Background: #0D0D0D
- Surface: #1A1A1A
- Primary: #E5C890 (Amber)
- Secondary: #81C784 (Green)
- Text Primary: #F5F5F5
- Text Secondary: #A0A0A0

#### タイポグラフィ
- 見出し: Inter (Sans-serif)
- 本文: Inter (Sans-serif)
- 数字: JetBrains Mono (Monospace)

### 9.2 主要画面

| 画面 | 主な機能 |
|------|----------|
| ダッシュボード | 現在作業/経過時間/今日の統計 |
| タイムライン | 作業記録一覧/編集 |
| プロジェクト | プロジェクト管理/ルール設定 |
| レポート | 期間別集計/エクスポート |
| 設定 | 各種設定 |

### 9.3 ADHD配慮

- 3クリック以内で主要操作完了
- 認知負荷を最小化（情報量制限）
- 明確なフィードバック（視覚＋音）
- カラーコーディングによる状態識別

---

## 10. セキュリティ要件

| ID | 要件 | 実装方法 |
|----|------|----------|
| SEC-001 | ローカルデータ暗号化 | AES-256 |
| SEC-002 | DB暗号化 | SQLCipher検討 |
| SEC-003 | パスワード画面検出 | type="password"判定でスキップ |
| SEC-004 | 除外キーワード | ユーザー定義キーワードでスキップ |
| SEC-005 | HTTPS通信 | OpenAI APIのみ外部通信 |
| SEC-006 | APIキー管理 | electron-store暗号化保存 |

---

## 11. パフォーマンス要件

| ID | 項目 | 目標値 |
|----|------|--------|
| PERF-001 | CPU（アイドル） | 1%以下 |
| PERF-002 | CPU（キャプチャ時） | 瞬間10%以下 |
| PERF-003 | CPU（AI判定時） | 20%以下 |
| PERF-004 | メモリ | 300MB以下 |
| PERF-005 | スクリーンショットサイズ | 200KB以下/枚 |
| PERF-006 | DBサイズ（1ヶ月） | 100MB以内 |
| PERF-007 | バッテリー影響 | 5%以下/8時間 |

---

## 12. AI判定要件

### 12.1 モデル構成（必須）

| 判定段階 | モデル | 用途 | 頻度 |
|---------|--------|------|------|
| 1次判定 | **gpt-5-nano** | 画面変化検知（Yes/No） | 1分ごと |
| 2次判定 | **gpt-5-mini** | プロジェクト詳細判定 | 変化時のみ |

### 12.2 判定フロー

```
画面キャプチャ (30秒〜2分)
        ↓
メタデータ収集 (5秒ごと)
        ↓
ルールマッチング (即時)
   ├─ マッチ → 確定（信頼度100%）
   └─ 不一致 ↓
        ↓
1次判定 (gpt-5-nano) - 変化検知
   ├─ 変化なし → スキップ
   └─ 変化あり ↓
        ↓
2次判定 (gpt-5-mini) - 詳細判定
        ↓
信頼度スコア算出
   ├─ ≥85% → 自動確定
   └─ <85% → ユーザー確認
```

### 12.3 信頼度スコア

| 範囲 | 状態 | アクション |
|------|------|-----------|
| 95-100% | 確実（✅緑） | 自動確定 |
| 85-94% | おそらく正しい（⚠️黄） | 自動確定 |
| <85% | 要確認（❓赤） | ユーザーに通知 |

### 12.4 コスト管理

- 月間予算: $2.00/ユーザー
- 超過時: 警告 → 判定頻度自動削減
- Batch API使用で50%コスト削減

---

## 13. コスト管理

### 13.1 月間コスト試算（1ユーザー）

| 項目 | 月間コスト |
|------|-----------|
| AI判定（nano） | $0.68 |
| AI判定（mini） | $0.30 |
| インフラ | $1.00 |
| 決済手数料 | $0.54 |
| **合計** | **$2.52** |

### 13.2 価格設定

| プラン | 価格 | 利益率 |
|--------|------|--------|
| Basic | $14.99/月 | 83% |
| Pro | $29.99/月 | 92% |
| Business | $79.99/月 | 93% |

---

## 14. 制約事項

### 14.1 技術的制約

- Windows 10/11, macOS 12+のみ（Linuxは対象外）
- マルチモニターは主モニターのみ（Phase 1）
- OpenAI APIレート制限: 60リクエスト/分

### 14.2 ビジネス制約

- 開発者: 1名（個人開発）
- 開発期間: Phase 1を2週間
- 外部サービス費用: 月$100まで

### 14.3 法的制約

- 日本の個人情報保護法対応
- ユーザー同意必須（スクリーンショット取得）

---

## 15. 開発スコープ

### 15.1 Phase 1: MVP（2週間）

**目標:** 自分で使えるバージョン

**含む機能:**
- 自動スクリーンショット（1分間隔）
- ウィンドウ/URL監視
- AI判定（gpt-5-nano + gpt-5-mini）
- プロジェクト登録（5個まで）
- 基本ルール設定
- リアルタイム表示
- 日次レポート
- 手動編集機能

**含まない機能:**
- 週次・月次レポート
- PDF/CSVエクスポート
- 高度な設定
- チーム機能

### 15.2 Phase 2: Beta版（1ヶ月）

- 週次・月次レポート
- PDF/CSVエクスポート
- 詳細設定画面
- 異常検知アラート
- 学習機能

### 15.3 Phase 3: 正式リリース（2ヶ月）

- 決済システム（Stripe）
- ライセンス管理
- 自動更新
- ヘルプドキュメント

---

## 16. 成功指標

| カテゴリ | KPI | 目標値 |
|---------|-----|--------|
| プロダクト | 判定精度 | 95%以上 |
| プロダクト | Day 7継続率 | 70% |
| プロダクト | Day 30継続率 | 50% |
| ビジネス | Year 1ユーザー | 500 |
| ビジネス | Year 1 MRR | $9,995 |
| ビジネス | 月間解約率 | 5%以下 |
| ユーザー | 時間節約 | 週5時間以上 |

---

## 17. 【補足】エラーハンドリング要件

### 17.1 エラー分類

| 種別 | 例 | 対応方針 |
|------|-----|----------|
| Fatal | DB破損、起動失敗 | エラー画面表示 → 再インストール案内 |
| Critical | API接続失敗 | リトライ(3回) → オフラインモード移行 |
| Warning | 低信頼度判定 | ユーザー通知 → 手動確認促す |
| Info | 設定変更完了 | トースト通知 |

### 17.2 リトライポリシー

- OpenAI API: 指数バックオフ（1s, 2s, 4s）、最大3回
- ファイル操作: 即時リトライ1回
- DB操作: トランザクションロールバック

### 17.3 オフラインモード

- ネット接続なしでもローカル動作継続
- AI判定をスキップ、ルールマッチングのみ
- 復旧時に未判定データをバッチ処理

---

## 18. 【補足】バックアップ・リカバリ要件

### 18.1 自動バックアップ

| 対象 | 頻度 | 保持期間 |
|------|------|----------|
| SQLiteデータベース | 1時間ごと | 7日間（7世代） |
| 設定ファイル | 変更時 | 直近5回 |
| スクリーンショット | リアルタイム | 7日間（設定可能） |

### 18.2 バックアップ保存先

- デフォルト: `{userData}/backups/`
- ファイル名: `autotracker_backup_{timestamp}.db`

### 18.3 リカバリ手順

1. アプリ起動時に最新バックアップの整合性チェック
2. 破損検知時は自動で直近バックアップから復元
3. 手動復元: 設定画面から任意のバックアップを選択

---

## 19. 【補足】テスト要件

### 19.1 テスト種別

| 種別 | 対象 | ツール | カバレッジ目標 |
|------|------|--------|---------------|
| Unit | ビジネスロジック | Vitest | 80%以上 |
| Integration | IPC通信/DB操作 | Vitest | 70%以上 |
| E2E | ユーザーフロー | Playwright | 主要フロー100% |
| Visual | UI/コンポーネント | Storybook | 主要コンポーネント |

### 19.2 テスト環境

- CI/CD: GitHub Actions
- テスト実行: PR作成時、main merge時
- カバレッジレポート: Codecov

### 19.3 主要テストケース

| カテゴリ | テストケース |
|---------|-------------|
| 画面キャプチャ | 正常取得/権限エラー/タイムアウト |
| AI判定 | 正常応答/エラー/タイムアウト/オフライン |
| データ保存 | CRUD操作/トランザクション/暗号化 |
| UI | プロジェクト作成/エントリー編集/レポート表示 |

---

## 20. 【補足】運用・監視要件

### 20.1 ログ出力

| ログレベル | 出力先 | 保持期間 |
|-----------|--------|----------|
| ERROR | ファイル + コンソール | 30日 |
| WARN | ファイル + コンソール | 7日 |
| INFO | ファイル | 3日 |
| DEBUG | 開発時のみ | - |

### 20.2 ログファイル

- 保存先: `{userData}/logs/`
- ファイル名: `autotracker_{date}.log`
- ローテーション: 日次、最大10MB/ファイル

### 20.3 クラッシュレポート

- 収集: オプトイン（ユーザー同意時のみ）
- 送信内容: スタックトレース、OS情報、アプリバージョン
- 個人情報: 含めない

### 20.4 使用統計（匿名）

- 収集: オプトイン
- 内容: 機能使用頻度、エラー発生率、AI判定精度
- 用途: プロダクト改善のみ

---

## 付録

### A. 用語集

| 用語 | 定義 |
|------|------|
| エントリー | 1つの連続した作業記録 |
| 信頼度 | AI判定の確実性（0-100%） |
| トラッキング | 時間記録の開始状態 |
| 請求可能時間 | 非業務時間を除いた稼働時間 |
| ルール | プロジェクト自動判定の条件 |

### B. 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| 1.0 | 2025-12-10 | 初版作成 |
| 1.1 | 2025-12-10 | エラーハンドリング/バックアップ/テスト/運用要件を補足 |

---

**END OF DOCUMENT**
